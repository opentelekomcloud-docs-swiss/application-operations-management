:original_name: ListEvents.html

.. _ListEvents:

Querying Events and Alarms
==========================

Function
--------

This API is used to query events and alarms of a user.

URI
---

POST /v2/{project_id}/events

.. table:: **Table 1** Path Parameters

   +------------+-----------+--------+-------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                   |
   +============+===========+========+===============================================================================+
   | project_id | Yes       | String | Project ID obtained from IAM. Generally, a project ID contains 32 characters. |
   +------------+-----------+--------+-------------------------------------------------------------------------------+

.. table:: **Table 2** Query Parameters

   +-----------------+-----------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                                                                                                                                                                            |
   +=================+=================+=================+========================================================================================================================================================================================================================================================================================+
   | type            | No              | String          | Type of information to be queried. active_alert: Active alarms are to be queried. history_alert: Historical alarms are to be queried. If this parameter is not transferred or other values are transferred, all information that meets the specified search criteria will be returned. |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                        |
   |                 |                 |                 | Enumeration values:                                                                                                                                                                                                                                                                    |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                        |
   |                 |                 |                 | -  **history_alert**                                                                                                                                                                                                                                                                   |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                        |
   |                 |                 |                 | -  **active_alert**                                                                                                                                                                                                                                                                    |
   +-----------------+-----------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 3** Request header parameters

   ============ ========= ====== ========================================
   Parameter    Mandatory Type   Description
   ============ ========= ====== ========================================
   X-Auth-Token Yes       String User token obtained from IAM.
   Content-Type Yes       String Content type, which is application/json.
   ============ ========= ====== ========================================

.. table:: **Table 4** Request body parameters

   +-------------------+-----------+---------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter         | Mandatory | Type                                                                      | Description                                                                                                                                                                                                                                                                                                                                                                                                                     |
   +===================+===========+===========================================================================+=================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | time_range        | Yes       | String                                                                    | Time range specified for query.Format: start time (UTC, in ms).end time (UTC, in ms).number of minutes in the time period. If both the start time and end time are -1, it indicates the latest N minutes. Time period specified for query. For example, -1.-1.5 indicates the latest 5 minutes. 1501545600000.1501632000000.1440 indicates the fixed time period from 08:00:00 on August 1, 2017 to 08:00:00 on August 2, 2017. |
   +-------------------+-----------+---------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | step              | No        | Long                                                                      | Statistical step. For example, if the step is one minute, set this parameter to 60,000.                                                                                                                                                                                                                                                                                                                                         |
   +-------------------+-----------+---------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | search            | No        | String                                                                    | Field specified for fuzzy query, which can be left blank. If the value is not empty, fuzzy match will be performed. The metadata field is mandatory.                                                                                                                                                                                                                                                                            |
   +-------------------+-----------+---------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | sort              | No        | :ref:`sort <listevents__request_sort>` object                             | Sorting order, which can be left blank.                                                                                                                                                                                                                                                                                                                                                                                         |
   +-------------------+-----------+---------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | metadata_relation | No        | Array of :ref:`RelationModel <listevents__request_relationmodel>` objects | Combination of search criteria, which can be left blank.                                                                                                                                                                                                                                                                                                                                                                        |
   +-------------------+-----------+---------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _listevents__request_sort:

.. table:: **Table 5** sort

   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type             | Description                                                                         |
   +=================+=================+==================+=====================================================================================+
   | order_by        | No              | Array of strings | List of sorted fields. Fields in this list are sorted based on the specified order. |
   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------+
   | order           | No              | String           | Sorting order. asc: ascending order. desc: descending order.                        |
   |                 |                 |                  |                                                                                     |
   |                 |                 |                  | Enumeration values:                                                                 |
   |                 |                 |                  |                                                                                     |
   |                 |                 |                  | -  **asc**                                                                          |
   |                 |                 |                  |                                                                                     |
   |                 |                 |                  | -  **desc**                                                                         |
   +-----------------+-----------------+------------------+-------------------------------------------------------------------------------------+

.. _listevents__request_relationmodel:

.. table:: **Table 6** RelationModel

   +-----------------+-----------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type             | Description                                                                                                                                         |
   +=================+=================+==================+=====================================================================================================================================================+
   | key             | No              | String           | Key specified for query, which corresponds to the key in the metadata.                                                                              |
   +-----------------+-----------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
   | value           | No              | Array of strings | Value of the specified key in the search criterion.                                                                                                 |
   +-----------------+-----------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
   | relation        | No              | String           | Relationship between search criteria. AND: All criteria must be met. OR: One of the criteria needs to be met. NOT: None of the criteria can be met. |
   |                 |                 |                  |                                                                                                                                                     |
   |                 |                 |                  | Enumeration values:                                                                                                                                 |
   |                 |                 |                  |                                                                                                                                                     |
   |                 |                 |                  | -  **AND**                                                                                                                                          |
   |                 |                 |                  |                                                                                                                                                     |
   |                 |                 |                  | -  **OR**                                                                                                                                           |
   |                 |                 |                  |                                                                                                                                                     |
   |                 |                 |                  | -  **NOT**                                                                                                                                          |
   +-----------------+-----------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------+

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 7** Response body parameters

   +-----------+----------------------------------------------------------------------+-------------------------+
   | Parameter | Type                                                                 | Description             |
   +===========+======================================================================+=========================+
   | events    | Array of :ref:`EventModel <listevents__response_eventmodel>` objects | Event or alarm details. |
   +-----------+----------------------------------------------------------------------+-------------------------+

.. _listevents__response_eventmodel:

.. table:: **Table 8** EventModel

   +-------------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter   | Type               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   +=============+====================+==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | starts_at   | Long               | Time when an event or alarm is generated (CST timestamp precise down to the millisecond).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   +-------------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | ends_at     | Long               | Time when an event or alarm is cleared (CST timestamp precise down to the millisecond). 0: The event or alarm is not deleted.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   +-------------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | timeout     | Long               | Duration at which an alarm is automatically cleared. Unit: ms. For example, if the duration is 1 minute, set this parameter to 60000. The default value is 3 days (that is, 3 days x 24 hours x 60 minutes x 60s x 1000 ms = 259,200,000 ms).                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   +-------------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | metadata    | Map<String,String> | Details of an event or alarm. The value is a key-value pair. A maximum of 30 sub-fields can be extended. The following fields are mandatory: - event_name: event or alarm name, which is a string. - event_severity: event severity, which is an enumerated value with string elements. Options: Critical, Major, Minor, and Info. - event_type: type, which is an enumerated value with string elements. Options: event and alarm. - resource_provider: name of the cloud service corresponding to an event, which is a string. - resource_type: resource type corresponding to an event, which is a string. - resource_id: resource information corresponding to the event, which is a string. |
   +-------------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | annotations | Map<String,String> | Additional field for an event or alarm, which can be left blank.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   +-------------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | id          | String             | Event or alarm ID, which is automatically generated by the system.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   +-------------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

**Status code: 400**

.. table:: **Table 9** Response body parameters

   +-----------------------+-----------------------+--------------------------+
   | Parameter             | Type                  | Description              |
   +=======================+=======================+==========================+
   | error_code            | String                | Response code.           |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **AOM.0403**          |
   +-----------------------+-----------------------+--------------------------+
   | error_msg             | String                | Error message.           |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **Invalid projectId** |
   +-----------------------+-----------------------+--------------------------+
   | error_type            | String                | API call failure type.   |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **Forbidden**         |
   +-----------------------+-----------------------+--------------------------+

**Status code: 401**

.. table:: **Table 10** Response body parameters

   +-----------------------+-----------------------+--------------------------+
   | Parameter             | Type                  | Description              |
   +=======================+=======================+==========================+
   | error_code            | String                | Response code.           |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **AOM.0403**          |
   +-----------------------+-----------------------+--------------------------+
   | error_msg             | String                | Error message.           |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **Invalid projectId** |
   +-----------------------+-----------------------+--------------------------+
   | error_type            | String                | API call failure type.   |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **Forbidden**         |
   +-----------------------+-----------------------+--------------------------+

**Status code: 403**

.. table:: **Table 11** Response body parameters

   +-----------------------+-----------------------+--------------------------+
   | Parameter             | Type                  | Description              |
   +=======================+=======================+==========================+
   | error_code            | String                | Response code.           |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **AOM.0403**          |
   +-----------------------+-----------------------+--------------------------+
   | error_msg             | String                | Error message.           |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **Invalid projectId** |
   +-----------------------+-----------------------+--------------------------+
   | error_type            | String                | API call failure type.   |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **Forbidden**         |
   +-----------------------+-----------------------+--------------------------+

**Status code: 500**

.. table:: **Table 12** Response body parameters

   +-----------------------+-----------------------+--------------------------+
   | Parameter             | Type                  | Description              |
   +=======================+=======================+==========================+
   | error_code            | String                | Response code.           |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **AOM.0403**          |
   +-----------------------+-----------------------+--------------------------+
   | error_msg             | String                | Error message.           |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **Invalid projectId** |
   +-----------------------+-----------------------+--------------------------+
   | error_type            | String                | API call failure type.   |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **Forbidden**         |
   +-----------------------+-----------------------+--------------------------+

**Status code: 503**

.. table:: **Table 13** Response body parameters

   +-----------------------+-----------------------+--------------------------+
   | Parameter             | Type                  | Description              |
   +=======================+=======================+==========================+
   | error_code            | String                | Response code.           |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **AOM.0403**          |
   +-----------------------+-----------------------+--------------------------+
   | error_msg             | String                | Error message.           |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **Invalid projectId** |
   +-----------------------+-----------------------+--------------------------+
   | error_type            | String                | API call failure type.   |
   |                       |                       |                          |
   |                       |                       | Enumeration values:      |
   |                       |                       |                          |
   |                       |                       | -  **Forbidden**         |
   +-----------------------+-----------------------+--------------------------+

Example Requests
----------------

Query the events and alarms of a specified user.

.. code-block:: text

   POST https://{endpoint}/v2/{project_id}/events

   {
     "time_range" : "-1.-1.30",
     "metadata_relation" : [ {
       "key" : "event_type",
       "relation" : "AND",
       "value" : [ "alarm" ]
     }, {
       "key" : "event_severity",
       "relation" : "AND",
       "value" : [ "Critical", "Major", "Minor", "Info" ]
     } ],
     "search" : "",
     "sort" : {
       "order_by" : [ "starts_at" ],
       "order" : "desc"
     }
   }

Example Responses
-----------------

**Status code: 200**

OK

The request is successful.

.. code-block::

   {
     "events" : [ {
       "annotations" : {
         "alarm_probableCause_zh_cn" : "Possible cause",
         "message" : "Alarm details",
         "alarm_fix_suggestion_zh_cn" : "Solution"
       },
       "arrives_at" : 163773632000,
       "attach_rule" : { },
       "ends_at" : 0,
       "id" : "6775161208461480000",
       "metadata" : {
         "event_type" : "alarm",
         "event_severity" : "Major",
         "resource_type" : "vm",
         "event_name" : "test",
         "resource_id" : "ecs123",
         "resource_provider" : "ecs"
       },
       "policy" : { },
       "starts_at" : 16377362908000,
       "timeout" : 60000
     } ],
     "page_info" : {
       "current_count" : 2,
       "next_marker" : "",
       "previous_marker" : ""
     }
   }

**Status code: 400**

Bad Request

The request is invalid. The client should not repeat the request without modifications.

.. code-block::

   {
     "error_code" : "AOM.0400",
     "error_message" : "param error",
     "error_type" : "SC_BAD_REQUEST"
   }

**Status code: 401**

Unauthorized

The authentication information is incorrect or invalid.

.. code-block::

   {
     "error_code" : "AOM.0401",
     "error_message" : "you dont have permission",
     "error_type" : "SC_UNAUTHORIZED"
   }

**Status code: 403**

Forbidden

The request is rejected. The server has received the request and understood it, but the server refuses to respond to it. The client should not repeat the request without modifications.

.. code-block::

   {
     "error_code" : "AOM.0403",
     "error_message" : "you dont have permission",
     "error_type" : "SC_FORBIDDEN"
   }

**Status code: 500**

Internal Server Error

The server is able to receive the request but unable to understand the request.

.. code-block::

   {
     "error_code" : "AOM.0500",
     "error_message" : "SC_INTERNAL_SERVER_ERROR",
     "error_type" : "SC_INTERNAL_SERVER_ERROR"
   }

**Status code: 503**

Service Unavailable

The requested service is invalid. The client should not repeat the request without modifications.

.. code-block::

   {
     "error_code" : "AOM.0503",
     "error_message" : "SC_NOT_IMPLEMENTED",
     "error_type" : "SC_NOT_IMPLEMENTED"
   }

Status Codes
------------

+-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Status Code                       | Description                                                                                                                                                                              |
+===================================+==========================================================================================================================================================================================+
| 200                               | OK                                                                                                                                                                                       |
|                                   |                                                                                                                                                                                          |
|                                   | The request is successful.                                                                                                                                                               |
+-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 400                               | Bad Request                                                                                                                                                                              |
|                                   |                                                                                                                                                                                          |
|                                   | The request is invalid. The client should not repeat the request without modifications.                                                                                                  |
+-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 401                               | Unauthorized                                                                                                                                                                             |
|                                   |                                                                                                                                                                                          |
|                                   | The authentication information is incorrect or invalid.                                                                                                                                  |
+-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 403                               | Forbidden                                                                                                                                                                                |
|                                   |                                                                                                                                                                                          |
|                                   | The request is rejected. The server has received the request and understood it, but the server refuses to respond to it. The client should not repeat the request without modifications. |
+-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 500                               | Internal Server Error                                                                                                                                                                    |
|                                   |                                                                                                                                                                                          |
|                                   | The server is able to receive the request but unable to understand the request.                                                                                                          |
+-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 503                               | Service Unavailable                                                                                                                                                                      |
|                                   |                                                                                                                                                                                          |
|                                   | The requested service is invalid. The client should not repeat the request without modifications.                                                                                        |
+-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Error Codes
-----------

See :ref:`Error Codes <errorcode>`.
